apiVersion: v1
kind: ConfigMap
metadata:
  name: maxkb-config
  namespace: maxkb-system
data:
  # 主配置
  config.yaml: |
    server:
      port: 8080
      host: 0.0.0.0
    maxkb:
      knowledge_base:
        default_name: "默认知识库"
        default_description: "系统默认知识库"
      retrieval:
        top_k: 5
        score_threshold: 0.7
      generation:
        temperature: 0.7
        max_tokens: 1000
    vector_db:
      type: pinecone
      index_name: maxkb
    llm:
      provider: openai
      model: gpt-3.5-turbo
  # 启动脚本
  start.sh: |
    #!/bin/bash
    set -e
    
    echo "Starting MaxKB..."
    
    # 加载环境变量
    export LLM_API_KEY=$(cat /etc/secrets/llm-api-key)
    export VECTOR_DB_API_KEY=$(cat /etc/secrets/vector-db-api-key)
    
    # 启动服务
    python -m maxkb.server
  # 监控配置
  prometheus.yaml: |
    global:
      scrape_interval: 15s
    scrape_configs:
      - job_name: 'maxkb'
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_label_app]
            regex: maxkb
            action: keep