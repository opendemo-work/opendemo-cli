apiVersion: v1
kind: ConfigMap
metadata:
  name: gemini-cli-config
  namespace: gemini-cli-system
data:
  # 主配置
  config.yaml: |
    server:
      port: 8080
      host: 0.0.0.0
    gemini:
      api:
        endpoint: https://generativelanguage.googleapis.com/v1
      model:
        name: gemini-1.5-pro
        temperature: 0.7
        max_output_tokens: 1000
    code:
      analysis:
        enabled: true
        timeout: 30s
      generation:
        enabled: true
        timeout: 60s
    repositories:
      github:
        enabled: true
      gitlab:
        enabled: false
  # 启动脚本
  start.sh: |
    #!/bin/bash
    set -e
    
    echo "Starting Gemini CLI Service..."
    
    # 加载环境变量
    export GEMINI_API_KEY=$(cat /etc/secrets/gemini-api-key)
    export GITHUB_TOKEN=$(cat /etc/secrets/github-token)
    
    # 启动服务
    python -m gemini_cli.server
  # 监控配置
  prometheus.yaml: |
    global:
      scrape_interval: 15s
    scrape_configs:
      - job_name: 'gemini-cli'
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_label_app]
            regex: gemini-cli
            action: keep