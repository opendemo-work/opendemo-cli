# Docker SDK for Node.js å®¹å™¨æ“ä½œç®¡ç†æ¼”ç¤º

## ç®€ä»‹
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„ Docker SDK å®è·µç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ `dockerode` åº“ä¸æœ¬åœ° Docker å®ˆæŠ¤è¿›ç¨‹äº¤äº’ï¼Œå®Œæˆå®¹å™¨çš„åˆ›å»ºã€å¯åŠ¨ã€æŸ¥çœ‹æ—¥å¿—ã€åœæ­¢å’Œåˆ é™¤ç­‰å¸¸è§è¿ç»´æ“ä½œã€‚é€‚ç”¨äº DevOps å·¥å…·å¼€å‘ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ç³»ç»Ÿå­¦ä¹ ã€‚

## å­¦ä¹ ç›®æ ‡
- æŒæ¡ Node.js ä¸­ä½¿ç”¨ Docker SDK æ§åˆ¶å®¹å™¨ç”Ÿå‘½å‘¨æœŸ
- ç†è§£å®¹å™¨æ“ä½œçš„æ ¸å¿ƒæ¦‚å¿µï¼ˆé•œåƒã€å®¹å™¨ã€çŠ¶æ€ï¼‰
- å­¦ä¼šå¤„ç†å¼‚æ­¥ Docker API è°ƒç”¨å’Œé”™è¯¯æ•è·
- æå‡å¯¹å®¹å™¨åŒ–åº”ç”¨è‡ªåŠ¨åŒ–çš„ç†è§£

## ç¯å¢ƒè¦æ±‚
- Node.js v16 æˆ–æ›´é«˜ç‰ˆæœ¬
- Docker å¼•æ“å·²å®‰è£…å¹¶æ­£åœ¨è¿è¡Œï¼ˆæ”¯æŒ Windowsã€macOSã€Linuxï¼‰
- npm åŒ…ç®¡ç†å·¥å…·

## å®‰è£…ä¾èµ–æ­¥éª¤
1. ç¡®ä¿å·²å®‰è£… Node.js å’Œ Dockerï¼š
   ```bash
   node --version
   docker --version
   ```
   é¢„æœŸè¾“å‡ºç±»ä¼¼ï¼š
   ```
   v18.17.0
   Docker version 24.0.7, build afdd53b
   ```

2. åˆå§‹åŒ–é¡¹ç›®ï¼ˆå¦‚å°šæœªåˆå§‹åŒ–ï¼‰ï¼š
   ```bash
   npm init -y
   ```

3. å®‰è£… dockerode ä¾èµ–ï¼š
   ```bash
   npm install dockerode
   ```

## æ–‡ä»¶è¯´æ˜
- `container-manager.js`ï¼šä¸»é€»è¾‘æ–‡ä»¶ï¼Œæ¼”ç¤ºå®¹å™¨çš„åˆ›å»ºã€å¯åŠ¨ã€æ—¥å¿—è·å–ã€åœæ­¢å’Œåˆ é™¤
- `image-inspect.js`ï¼šæ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šé•œåƒï¼Œè¾…åŠ©åˆ¤æ–­æ‹‰å–éœ€æ±‚
- `list-containers.js`ï¼šåˆ—å‡ºå½“å‰æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰

## é€æ­¥å®æ“æŒ‡å—

### æ­¥éª¤ 1ï¼šè¿è¡Œå®¹å™¨ç®¡ç†ç¤ºä¾‹
```bash
node container-manager.js
```

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ… å®¹å™¨å·²åˆ›å»ºï¼ŒID: abc123...
âœ… å®¹å™¨å·²å¯åŠ¨
ğŸ“œ æ—¥å¿—æµå¼€å§‹...
Hello from Alpine!
âœ… å®¹å™¨å·²åœæ­¢
ğŸ—‘ï¸ å®¹å™¨å·²åˆ é™¤
```

### æ­¥éª¤ 2ï¼šæŸ¥çœ‹å½“å‰æ‰€æœ‰å®¹å™¨
```bash
node list-containers.js
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ“Š å½“å‰å®¹å™¨åˆ—è¡¨ï¼š
- åœæ­¢  my-test-container
- è¿è¡Œ  redis
```

### æ­¥éª¤ 3ï¼šæ£€æŸ¥é•œåƒä¿¡æ¯
```bash
node image-inspect.js
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ“¦ é•œåƒä¿¡æ¯ï¼šalpine:latest
ID: sha256:abc...
æ ‡ç­¾: alpine:latest
```
æˆ–
```
âŒ é•œåƒ alpine:latest æœªæ‰¾åˆ°ï¼Œè¯·å…ˆè¿è¡Œ 'docker pull alpine'ã€‚
```

## ä»£ç è§£æ

### container-manager.js å…³é”®æ®µ
```js
const container = await docker.createContainer({
  Image: 'alpine',
  Cmd: ['echo', 'Hello from Alpine!'],
  name: 'my-test-container'
});
```
- ä½¿ç”¨ `createContainer` åˆ›å»ºåŸºäº alpine é•œåƒçš„å®¹å™¨
- `Cmd` æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶æ‰§è¡Œçš„å‘½ä»¤
- `name` ä¾¿äºåç»­è¯†åˆ«å’Œç®¡ç†

```js
await container.start();
const logStream = await container.logs({ stdout: true, stderr: true, follow: true });
```
- å¯åŠ¨å®¹å™¨å¹¶è·å–å®æ—¶æ—¥å¿—æµ
- `follow: true` ä¿æŒæµæ‰“å¼€ç›´åˆ°ç»“æŸ

### é”™è¯¯å¤„ç†
æ‰€æœ‰ Docker æ“ä½œéƒ½åŒ…è£¹åœ¨ try-catch ä¸­ï¼Œç¡®ä¿å¼‚å¸¸ä¸ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¹¶æä¾›æ¸…æ™°æç¤ºã€‚

## é¢„æœŸè¾“å‡ºç¤ºä¾‹
è§ä¸Šæ–‡å„æ­¥éª¤è¯´æ˜ã€‚

## å¸¸è§é—®é¢˜è§£ç­”

**Q: æŠ¥é”™ `Cannot connect to the Docker daemon`ï¼Ÿ**
A: ç¡®ä¿ Docker Desktopï¼ˆWindows/macOSï¼‰æˆ– Docker æœåŠ¡ï¼ˆLinuxï¼‰æ­£åœ¨è¿è¡Œã€‚

**Q: æ‰¾ä¸åˆ° alpine é•œåƒï¼Ÿ**
A: æ‰‹åŠ¨æ‹‰å–ï¼š`docker pull alpine`

**Q: æƒé™è¢«æ‹’ç»ï¼ˆLinuxï¼‰ï¼Ÿ**
A: å°†ç”¨æˆ·åŠ å…¥ docker ç»„ï¼š`sudo usermod -aG docker $USER`ï¼Œç„¶åé‡æ–°ç™»å½•ã€‚

## æ‰©å±•å­¦ä¹ å»ºè®®
- å°è¯•æŒ‚è½½å·ï¼ˆbind mountsï¼‰æˆ–ä½¿ç”¨ç½‘ç»œ
- å®ç°å®¹å™¨å¥åº·æ£€æŸ¥è½®è¯¢
- ç»“åˆ Express æ„å»º REST API æ¥è¿œç¨‹æ§åˆ¶å®¹å™¨
- ä½¿ç”¨ docker-compose é…åˆå¤šå®¹å™¨ç¼–æ’
- æ¢ç´¢ Kubernetes Node.js å®¢æˆ·ç«¯è¿›è¡Œæ›´é«˜çº§ç¼–æ’
